type: Test
spec:
  id: atlDbvLSg
  name: git-github
  trigger:
    type: http
    httpRequest:
      method: POST
      url: https://gitbridge.aws.optimizor.app/github
      body: "{\n  \"ref\": \"refs/heads/master\",\n  \"before\": \"737d38c599c1b2991664dfc6155d6bf516fcce36\",\n  \"after\": \"fd489864e7642b48eaad6e3f155c10e46810ec72\",\n  \"created\": false,\n  \"deleted\": false,\n  \"forced\": false,\n  \"base_ref\": null,\n  \"compare\": \"https://github.com/binkkatal/sample_app/compare/737d38c599c1...fd489864e764\",\n  \"commits\": [\n    {\n      \"id\": \"fd489864e7642b48eaad6e3f155c10e46810ec72\",\n      \"tree_id\": \"55e08136e14d5168b699038f88c73e175ddffd3b\",\n      \"distinct\": true,\n      \"message\": \"test a push event\",\n      \"timestamp\": \"2018-06-29T19:34:13+05:30\",\n      \"url\": \"https://github.com/binkkatal/sample_app/commit/fd489864e7642b48eaad6e3f155c10e46810ec72\",\n      \"author\": {\n        \"name\": \"QT\",\n        \"email\": \"binkkatal.r@gmail.com\",\n        \"username\": \"binkkatal\"\n      },\n      \"committer\": {\n        \"name\": \"binkkatal\",\n        \"email\": \"binkkatal.r@gmail.com\",\n        \"username\": \"binkkatal\"\n      },\n      \"added\": [\n        \".razorops.yaml\"\n      ],\n      \"removed\": [\n      ],\n      \"modified\": [\n        \"app/controllers/application_controller.rb\"\n      ]\n    }\n  ],\n  \"head_commit\": {\n    \"id\": \"fd489864e7642b48eaad6e3f155c10e46810ec72\",\n    \"tree_id\": \"55e08136e14d5168b699038f88c73e175ddffd3b\",\n    \"distinct\": true,\n    \"message\": \"test a push event\",\n    \"timestamp\": \"2018-06-29T19:34:13+05:30\",\n    \"url\": \"https://github.com/binkkatal/sample_app/commit/fd489864e7642b48eaad6e3f155c10e46810ec72\",\n    \"author\": {\n      \"name\": \"QT\",\n      \"email\": \"binkkatal.r@gmail.com\",\n      \"username\": \"binkkatal\"\n    },\n    \"committer\": {\n      \"name\": \"binkkatal\",\n      \"email\": \"binkkatal.r@gmail.com\",\n      \"username\": \"binkkatal\"\n    },\n    \"added\": [\n      \".razorops.yaml\"\n    ],\n    \"removed\": [\n    ],\n    \"modified\": [\n      \"app/controllers/application_controller.rb\"\n    ]\n  },\n  \"repository\": {\n    \"id\": 63933911,\n    \"node_id\": \"MDEwOlJlcG9zaXRvcnk2MzkzMzkxMQ==\",\n    \"name\": \"sample_app\",\n    \"full_name\": \"binkkatal/sample_app\",\n    \"owner\": {\n      \"name\": \"binkkatal\",\n      \"email\": \"binkkatal.r@gmail.com\",\n      \"login\": \"binkkatal\",\n      \"id\": 13351472,\n      \"node_id\": \"MDQ6VXNlcjEzMzUxNDcy\",\n      \"avatar_url\": \"https://avatars3.githubusercontent.com/u/13351472?v=4\",\n      \"gravatar_id\": \"\",\n      \"url\": \"https://api.github.com/users/binkkatal\",\n      \"html_url\": \"https://github.com/binkkatal\",\n      \"followers_url\": \"https://api.github.com/users/binkkatal/followers\",\n      \"following_url\": \"https://api.github.com/users/binkkatal/following{/other_user}\",\n      \"gists_url\": \"https://api.github.com/users/binkkatal/gists{/gist_id}\",\n      \"starred_url\": \"https://api.github.com/users/binkkatal/starred{/owner}{/repo}\",\n      \"subscriptions_url\": \"https://api.github.com/users/binkkatal/subscriptions\",\n      \"organizations_url\": \"https://api.github.com/users/binkkatal/orgs\",\n      \"repos_url\": \"https://api.github.com/users/binkkatal/repos\",\n      \"events_url\": \"https://api.github.com/users/binkkatal/events{/privacy}\",\n      \"received_events_url\": \"https://api.github.com/users/binkkatal/received_events\",\n      \"type\": \"User\",\n      \"site_admin\": false\n    },\n    \"private\": false,\n    \"html_url\": \"https://github.com/binkkatal/sample_app\",\n    \"description\": null,\n    \"fork\": false,\n    \"url\": \"https://github.com/binkkatal/sample_app\",\n    \"forks_url\": \"https://api.github.com/repos/binkkatal/sample_app/forks\",\n    \"keys_url\": \"https://api.github.com/repos/binkkatal/sample_app/keys{/key_id}\",\n    \"collaborators_url\": \"https://api.github.com/repos/binkkatal/sample_app/collaborators{/collaborator}\",\n    \"teams_url\": \"https://api.github.com/repos/binkkatal/sample_app/teams\",\n    \"hooks_url\": \"https://api.github.com/repos/binkkatal/sample_app/hooks\",\n    \"issue_events_url\": \"https://api.github.com/repos/binkkatal/sample_app/issues/events{/number}\",\n    \"events_url\": \"https://api.github.com/repos/binkkatal/sample_app/events\",\n    \"assignees_url\": \"https://api.github.com/repos/binkkatal/sample_app/assignees{/user}\",\n    \"branches_url\": \"https://api.github.com/repos/binkkatal/sample_app/branches{/branch}\",\n    \"tags_url\": \"https://api.github.com/repos/binkkatal/sample_app/tags\",\n    \"blobs_url\": \"https://api.github.com/repos/binkkatal/sample_app/git/blobs{/sha}\",\n    \"git_tags_url\": \"https://api.github.com/repos/binkkatal/sample_app/git/tags{/sha}\",\n    \"git_refs_url\": \"https://api.github.com/repos/binkkatal/sample_app/git/refs{/sha}\",\n    \"trees_url\": \"https://api.github.com/repos/binkkatal/sample_app/git/trees{/sha}\",\n    \"statuses_url\": \"https://api.github.com/repos/binkkatal/sample_app/statuses/{sha}\",\n    \"languages_url\": \"https://api.github.com/repos/binkkatal/sample_app/languages\",\n    \"stargazers_url\": \"https://api.github.com/repos/binkkatal/sample_app/stargazers\",\n    \"contributors_url\": \"https://api.github.com/repos/binkkatal/sample_app/contributors\",\n    \"subscribers_url\": \"https://api.github.com/repos/binkkatal/sample_app/subscribers\",\n    \"subscription_url\": \"https://api.github.com/repos/binkkatal/sample_app/subscription\",\n    \"commits_url\": \"https://api.github.com/repos/binkkatal/sample_app/commits{/sha}\",\n    \"git_commits_url\": \"https://api.github.com/repos/binkkatal/sample_app/git/commits{/sha}\",\n    \"comments_url\": \"https://api.github.com/repos/binkkatal/sample_app/comments{/number}\",\n    \"issue_comment_url\": \"https://api.github.com/repos/binkkatal/sample_app/issues/comments{/number}\",\n    \"contents_url\": \"https://api.github.com/repos/binkkatal/sample_app/contents/{+path}\",\n    \"compare_url\": \"https://api.github.com/repos/binkkatal/sample_app/compare/{base}...{head}\",\n    \"merges_url\": \"https://api.github.com/repos/binkkatal/sample_app/merges\",\n    \"archive_url\": \"https://api.github.com/repos/binkkatal/sample_app/{archive_format}{/ref}\",\n    \"downloads_url\": \"https://api.github.com/repos/binkkatal/sample_app/downloads\",\n    \"issues_url\": \"https://api.github.com/repos/binkkatal/sample_app/issues{/number}\",\n    \"pulls_url\": \"https://api.github.com/repos/binkkatal/sample_app/pulls{/number}\",\n    \"milestones_url\": \"https://api.github.com/repos/binkkatal/sample_app/milestones{/number}\",\n    \"notifications_url\": \"https://api.github.com/repos/binkkatal/sample_app/notifications{?since,all,participating}\",\n    \"labels_url\": \"https://api.github.com/repos/binkkatal/sample_app/labels{/name}\",\n    \"releases_url\": \"https://api.github.com/repos/binkkatal/sample_app/releases{/id}\",\n    \"deployments_url\": \"https://api.github.com/repos/binkkatal/sample_app/deployments\",\n    \"created_at\": 1469173225,\n    \"updated_at\": \"2016-07-22T07:48:39Z\",\n    \"pushed_at\": 1530281075,\n    \"git_url\": \"git://github.com/binkkatal/sample_app.git\",\n    \"ssh_url\": \"git@github.com:binkkatal/sample_app.git\",\n    \"clone_url\": \"https://github.com/binkkatal/sample_app.git\",\n    \"svn_url\": \"https://github.com/binkkatal/sample_app\",\n    \"homepage\": null,\n    \"size\": 23,\n    \"stargazers_count\": 0,\n    \"watchers_count\": 0,\n    \"language\": \"Ruby\",\n    \"has_issues\": true,\n    \"has_projects\": true,\n    \"has_downloads\": true,\n    \"has_wiki\": true,\n    \"has_pages\": false,\n    \"forks_count\": 0,\n    \"mirror_url\": null,\n    \"archived\": false,\n    \"open_issues_count\": 0,\n    \"license\": null,\n    \"forks\": 0,\n    \"open_issues\": 0,\n    \"watchers\": 0,\n    \"default_branch\": \"master\",\n    \"stargazers\": 0,\n    \"master_branch\": \"master\"\n  },\n  \"pusher\": {\n    \"name\": \"binkkatal\",\n    \"email\": \"binkkatal.r@gmail.com\"\n  },\n  \"sender\": {\n    \"login\": \"binkkatal\",\n    \"id\": 13351472,\n    \"node_id\": \"MDQ6VXNlcjEzMzUxNDcy\",\n    \"avatar_url\": \"https://avatars3.githubusercontent.com/u/13351472?v=4\",\n    \"gravatar_id\": \"\",\n    \"url\": \"https://api.github.com/users/binkkatal\",\n    \"html_url\": \"https://github.com/binkkatal\",\n    \"followers_url\": \"https://api.github.com/users/binkkatal/followers\",\n    \"following_url\": \"https://api.github.com/users/binkkatal/following{/other_user}\",\n    \"gists_url\": \"https://api.github.com/users/binkkatal/gists{/gist_id}\",\n    \"starred_url\": \"https://api.github.com/users/binkkatal/starred{/owner}{/repo}\",\n    \"subscriptions_url\": \"https://api.github.com/users/binkkatal/subscriptions\",\n    \"organizations_url\": \"https://api.github.com/users/binkkatal/orgs\",\n    \"repos_url\": \"https://api.github.com/users/binkkatal/repos\",\n    \"events_url\": \"https://api.github.com/users/binkkatal/events{/privacy}\",\n    \"received_events_url\": \"https://api.github.com/users/binkkatal/received_events\",\n    \"type\": \"User\",\n    \"site_admin\": false\n  }\n}"
      headers:
      - key: Content-Type
        value: application/json
      - key: X-GitHub-Event
        value: push
  specs:
  - selector: span[qualitytrace.span.type="general" name="Qualitytrace trigger"]
    assertions:
    - attr:name = "Qualitytrace trigger"
    - attr:qualitytrace.response.status = 200
    - attr:qualitytrace.span.name = "Qualitytrace trigger"
    - attr:qualitytrace.span.type = "general"
  - selector: span[qualitytrace.span.type="http" name="/github" http.method="POST"]
    assertions:
    - attr:http.method = "POST"
    - attr:http.route = "/github"
    - attr:http.scheme = "http"
    - attr:http.status_code = 200
    - attr:net.host.name = "kubviz"
    - attr:qualitytrace.span.name = "/github"
    - attr:qualitytrace.span.type = "http"
  - selector: span[qualitytrace.span.type="http" name="PostGithub" http.method="POST"]
    assertions:
    - attr:http.method = "POST"
    - attr:name = "PostGithub"
    - attr:qualitytrace.span.name = "PostGithub"
    - attr:qualitytrace.span.type = "http"